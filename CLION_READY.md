# âœ… CLion å·²å°±ç»ªï¼

## ğŸ‰ æ­å–œï¼ç³»ç»Ÿå·²æˆåŠŸè¿è¡Œ

ä½ çš„ Zixiao OS åˆšåˆšåœ¨ QEMU ä¸­æˆåŠŸå¯åŠ¨äº†ï¼

## ğŸ“‹ åœ¨ CLion ä¸­çš„å®Œæ•´å·¥ä½œæµç¨‹

### æ­¥éª¤ 1: é‡æ–°åŠ è½½ CMake é¡¹ç›®

åœ¨ CLion ä¸­ï¼š
1. **File** â†’ **Reload CMake Project**
2. ç­‰å¾… CMake é…ç½®å®Œæˆ

ä½ åº”è¯¥çœ‹åˆ°ï¼š
```
-- Building for architecture: arm64
-- C Compiler: aarch64-unknown-linux-gnu-gcc
-- Output: zixiao-arm64.elf
```

### æ­¥éª¤ 2: æ„å»ºå†…æ ¸

ç‚¹å‡»å·¥å…·æ çš„ **é”¤å­å›¾æ ‡** ğŸ”¨ æˆ–æŒ‰ `Cmd+F9`

æ„å»ºæˆåŠŸåä¼šåœ¨ `cmake-build-arm64/` ç›®å½•ç”Ÿæˆ `zixiao-arm64.elf`

### æ­¥éª¤ 3: è¿è¡Œå†…æ ¸

#### æ–¹å¼ A: ä½¿ç”¨ CMake ç›®æ ‡ï¼ˆæ¨èï¼‰

1. æ‰“å¼€ **CMake** å·¥å…·çª—å£ (View â†’ Tool Windows â†’ CMake)
2. å±•å¼€ç›®æ ‡åˆ—è¡¨ï¼Œæ‰¾åˆ° `run`
3. å³é”®ç‚¹å‡» `run` â†’ **Build**

QEMU ä¼šå¯åŠ¨å¹¶æ˜¾ç¤ºå†…æ ¸è¾“å‡ºã€‚

#### æ–¹å¼ B: ä½¿ç”¨ Run Configuration

1. ç‚¹å‡»å·¥å…·æ çš„ **Edit Configurations...**
2. **+** â†’ **CMake Application**
3. è®¾ç½®:
   - **Name**: Run Zixiao OS
   - **Target**: run
   - **Executable**: `cmake-build-arm64/zixiao-arm64.elf`
4. **OK**
5. ç‚¹å‡»è¿è¡ŒæŒ‰é’® â–¶ï¸ æˆ–æŒ‰ `Ctrl+R`

#### é€€å‡º QEMU
åœ¨ QEMU æ§åˆ¶å°ä¸­æŒ‰ï¼š`Ctrl+A` ç„¶åæŒ‰ `X`

### æ­¥éª¤ 4: è°ƒè¯•å†…æ ¸

#### 4.1 å¯åŠ¨ GDB æœåŠ¡å™¨

æ–¹å¼ A - ä½¿ç”¨ CMake ç›®æ ‡ï¼š
1. åœ¨ CMake å·¥å…·çª—å£ä¸­æ‰¾åˆ° `debug` ç›®æ ‡
2. å³é”® â†’ **Build**

æ–¹å¼ B - ä½¿ç”¨ç»ˆç«¯ï¼š
```bash
qemu-system-aarch64 -M virt -cpu cortex-a57 \
  -kernel cmake-build-arm64/zixiao-arm64.elf \
  -m 512M -nographic -s -S
```

è¿™ä¼šå¯åŠ¨ QEMU å¹¶æš‚åœï¼Œç­‰å¾… GDB è¿æ¥åœ¨ç«¯å£ 1234ã€‚

#### 4.2 é…ç½® Remote Debug

1. **Run** â†’ **Edit Configurations...**
2. **+** â†’ **Remote Debug**
3. é…ç½®:
   - **Name**: Debug Zixiao ARM64
   - **'target remote' args**: `localhost:1234`
   - **Symbol file**: `cmake-build-arm64/zixiao-arm64.elf`
   - **Path mappings**: (ç•™ç©º)

4. **GDB/LLDB**:
   - macOS: ä½¿ç”¨ `lldb` (CLion ä¼šè‡ªåŠ¨ä½¿ç”¨)
   - æˆ–è€…å®‰è£… `gdb-multiarch`:
     ```bash
     brew install gdb
     ```

5. **OK**

#### 4.3 å¼€å§‹è°ƒè¯•

1. ç¡®ä¿ QEMU GDB æœåŠ¡å™¨æ­£åœ¨è¿è¡Œï¼ˆæ­¥éª¤ 4.1ï¼‰
2. ä»å·¥å…·æ é€‰æ‹© **Debug Zixiao ARM64**
3. ç‚¹å‡» **Debug** æŒ‰é’® ğŸ› æˆ–æŒ‰ `Ctrl+D`

CLion ä¼šè¿æ¥åˆ° QEMUï¼Œä½ å¯ä»¥ï¼š
- åœ¨ä»£ç ä¸­è®¾ç½®æ–­ç‚¹ï¼ˆç‚¹å‡»è¡Œå·æ—è¾¹ï¼‰
- å•æ­¥æ‰§è¡Œ (F8: Step Over, F7: Step Into)
- æŸ¥çœ‹å˜é‡ã€å¯„å­˜å™¨ã€å†…å­˜
- æŸ¥çœ‹è°ƒç”¨æ ˆ

#### æ¨èæ–­ç‚¹ä½ç½®

```c
// src/arch/arm64/kernel_main.c
void kernel_main(void)  // å†…æ ¸å…¥å£ç‚¹

// src/arch/arm64/drivers/uart.c
void console_putchar(char c)  // å­—ç¬¦è¾“å‡º

// src/arch/arm64/interrupts/exceptions.c
void arm64_irq_handler(void)  // ä¸­æ–­å¤„ç†
```

### æ­¥éª¤ 5: ç¼–è¾‘å’Œé‡æ–°æ„å»º

1. ä¿®æ”¹æºä»£ç 
2. **Cmd+S** ä¿å­˜
3. **Cmd+F9** é‡æ–°æ„å»º
4. è¿è¡Œæˆ–è°ƒè¯•æŸ¥çœ‹ä¿®æ”¹æ•ˆæœ

## ğŸ”§ å¸¸ç”¨æ“ä½œ

### åˆ‡æ¢æ¶æ„

ä¿®æ”¹ CMakeLists.txt ç¬¬ 5 è¡Œï¼š
```cmake
set(ARCH "arm64" CACHE STRING "Target architecture: arm64 or x86_64")
```

æ”¹ä¸º `"x86_64"` ç„¶åé‡æ–°åŠ è½½ CMakeã€‚

### æŸ¥çœ‹ç¼–è¯‘è¾“å‡º

**Build** å·¥å…·çª—å£ä¼šæ˜¾ç¤ºå®Œæ•´çš„ç¼–è¯‘å‘½ä»¤å’Œé”™è¯¯ä¿¡æ¯ã€‚

### æ¸…ç†æ„å»º

**Build** â†’ **Clean** æˆ–æ‰‹åŠ¨åˆ é™¤ `cmake-build-arm64/` ç›®å½•ã€‚

## âŒ¨ï¸ å¿«æ·é”®é€ŸæŸ¥

| æ“ä½œ | å¿«æ·é”® | è¯´æ˜ |
|------|--------|------|
| æ„å»º | Cmd+F9 | ç¼–è¯‘å†…æ ¸ |
| è¿è¡Œ | Ctrl+R | è¿è¡Œ QEMU |
| è°ƒè¯• | Ctrl+D | å¯åŠ¨è°ƒè¯•å™¨ |
| åœæ­¢ | Cmd+F2 | åœæ­¢è¿è¡Œ/è°ƒè¯• |
| æ–­ç‚¹ | Cmd+F8 | åˆ‡æ¢æ–­ç‚¹ |
| Step Over | F8 | å•æ­¥è·³è¿‡å‡½æ•° |
| Step Into | F7 | å•æ­¥è¿›å…¥å‡½æ•° |
| Step Out | Shift+F8 | è·³å‡ºå‡½æ•° |
| Resume | Cmd+Alt+R | ç»§ç»­æ‰§è¡Œ |
| æŸ¥çœ‹å€¼ | Alt+F8 | å¿«é€Ÿæ±‚å€¼è¡¨è¾¾å¼ |

## ğŸ“Š é¡¹ç›®ç»“æ„å¯¼èˆª

### å¿«é€Ÿå¯¼èˆª
- **Cmd+O**: æŒ‰æ–‡ä»¶åæœç´¢
- **Cmd+Shift+O**: æŒ‰ç¬¦å·æœç´¢ï¼ˆå‡½æ•°ã€å˜é‡ï¼‰
- **Cmd+B**: è·³è½¬åˆ°å®šä¹‰
- **Cmd+Alt+â† / â†’**: å‰è¿›/åé€€

### é¡¹ç›®è§†å›¾
- **Project** å·¥å…·çª—å£æ˜¾ç¤ºæ–‡ä»¶æ ‘
- **Structure** å·¥å…·çª—å£æ˜¾ç¤ºå½“å‰æ–‡ä»¶çš„å‡½æ•°åˆ—è¡¨

## ğŸ› è°ƒè¯•æŠ€å·§

### æŸ¥çœ‹æ±‡ç¼–ä»£ç 
è°ƒè¯•æ—¶å³é”®ä»£ç ç¼–è¾‘å™¨ â†’ **Show Disassembly**

### æŸ¥çœ‹å¯„å­˜å™¨
è°ƒè¯•æ—¶æ‰“å¼€ **Debug** â†’ **Registers** çª—å£

### æŸ¥çœ‹å†…å­˜
è°ƒè¯•æ—¶ **Run** â†’ **View Memory** â†’ è¾“å…¥åœ°å€

### æ¡ä»¶æ–­ç‚¹
å³é”®æ–­ç‚¹ â†’ **Edit Breakpoint** â†’ è®¾ç½®æ¡ä»¶

## ğŸ¯ ä¸‹ä¸€æ­¥å»ºè®®

1. **ç†Ÿæ‚‰ä»£ç **:
   - é˜…è¯» `src/arch/arm64/kernel_main.c`
   - ç†è§£å¯åŠ¨æµç¨‹

2. **å®éªŒä¿®æ”¹**:
   - ä¿®æ”¹æ¬¢è¿ä¿¡æ¯
   - æ·»åŠ æ–°çš„ printf è¾“å‡º
   - å°è¯•æ·»åŠ ç®€å•åŠŸèƒ½

3. **æ·±å…¥è°ƒè¯•**:
   - åœ¨ `kernel_main` è®¾ç½®æ–­ç‚¹
   - å•æ­¥æ‰§è¡Œæ¯ä¸€è¡Œ
   - è§‚å¯Ÿå˜é‡å˜åŒ–

4. **æ‰©å±•åŠŸèƒ½**:
   - æŸ¥çœ‹ `PROJECT_OVERVIEW.md` çš„"ä¸‹ä¸€æ­¥è®¡åˆ’"
   - é€‰æ‹©æ„Ÿå…´è¶£çš„åŠŸèƒ½å®ç°

## ğŸ“š ç›¸å…³æ–‡æ¡£

- `README.md` - é¡¹ç›®å®Œæ•´æ–‡æ¡£
- `CLION_SETUP.md` - è¯¦ç»†é…ç½®è¯´æ˜
- `PROJECT_OVERVIEW.md` - ä»£ç ç»“æ„å’Œç»Ÿè®¡

---

**ä½ ç°åœ¨å¯ä»¥åœ¨ CLion ä¸­å®Œæ•´åœ°å¼€å‘ã€æ„å»ºã€è¿è¡Œå’Œè°ƒè¯• Zixiao OS äº†ï¼** ğŸš€
